<html>
<head>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css">

<script type="text/javascript" src="javascripts/jszip.js"></script>

<script type="text/javascript" src="javascripts/jszip-utils.js"></script>
<!--
Mandatory in IE 6, 7, 8 and 9.
-->
<!--[if IE]>
<script type="text/javascript" src="javascripts/jszip-utils-ie.js"></script>
<![endif]-->

<!--
Any version of jQuery will do (it's just to write some examples), this one
happens to be available in our tests.
-->
<script type="text/javascript" src="javascripts/jQuery-1.10.2.js"></script>

<script type="text/javascript" src="javascripts/FileSaver.js"></script>
<script type="text/javascript" src="javascripts/main.js"></script>

</head>

<body>
<h1>EZ Activity Stream Generator</h1>
<br />
<p><b>Name</b> (optional):</p>
<input type="text" style="width: 500px; height:40px" id="addon_name" value="My Activity Stream">

<p><b>Description</b> (required):</p>
<textarea id="description" style="width: 500px; height:100px"></textarea>
<br>
<br>

<p><b>Paste your transform .js here</b> (required):</p>
<textarea id="xform_js" style="width: 500px; height:200px"></textarea>
<br>
<br>

<p><b>Paste some custom html here</b> (optional):</p>
<textarea id="custom_html" style="width: 500px; height:200px"></textarea>
<br>
<br>

<p><b>Paste some custom css here</b> (optional):</p>
<textarea id="custom_css" style="width: 500px; height:200px"></textarea>
<br>
<br>

<p><b>Upload an icon</b>:</p>
<form id="form1" runat="server">
    <input type='file' id="inputFile" />
    <img id="image_upload_preview" src="sample-icon-128.png" alt="your image" width="128px"/>
</form>

<button id="blob" class="btn btn-primary">Download add-on .zip</button>
<div id="j-notice" style="width: 50%"></div>
</body>

<head>
    <script>

        $("#inputFile").change(function () {
            readURL(this);
        });

        $("#xform_js").focus();

        // Blob
        if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1) {
            $("#j-notice").html("<br>For Safari browsers, the file will download with a name like <b>Unknown</b>. " +
                    "You can upload this straightaway to your Jive instance, or rename name the file with a .zip extension to easily view its contents.");
            // data URI
            function downloadWithDataURI() {
                window.location = "data:application/zip;base64," + createZip().generate({type:"base64"});
            }
            var dataUriLink = document.getElementById('blob');
            bindEvent(dataUriLink, 'click', downloadWithDataURI);
        } else {
            // other
            // safari
            var blobLink = document.getElementById('blob');
            if (JSZip.support.blob) {
                function downloadWithBlob() {
                    try {
                        var blob = createZip().generate({type:"blob"});
                        // see FileSaver.js
                        saveAs(blob, addonName + ".zip");
                    } catch(e) {
                        blobLink.innerHTML += " " + e;
                    }
                    return false;
                }
                bindEvent(blobLink, 'click', downloadWithBlob);
            } else {
                blobLink.innerHTML += " (not supported on this browser)";
            }
        }
    </script>
</head>
</html>
